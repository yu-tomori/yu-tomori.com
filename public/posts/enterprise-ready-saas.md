# Enterprise readyなSaaSについて

## 組織構造に由来するもの

エンタープライズ企業にSaaSを導入する時、大抵は特定の部門が試しに使うとか、特定部門内の2~3人に限定された範囲で使ってもらうことが多いだろう。しかし、遅かれ早かれ他部門にデータを共有したいという話が出てくる。

あなたのサービスがSSoT(Single Source of Trush)を売りにしているなら、他部門の方にリンクを共有することで最新の情報をみてもらえます、という風に言いたいだろうし、そうやって他部門の方にアカウントを作ってもらったらその部門への価値提供の機会も得られ、売上拡大にも繋がる。

お客様からの要請とビジネス観点の要請が重なるところなので、この力学は強力である。

何が言いたいかというと、エンタープライズ企業向けのSaaSを立ち上げる時、複数部門による利用がほぼ確実に要求されるということだ。当然、部門という枠に限定されることはなく、いずれ地方の営業所、子会社や関連会社、海外の現地法人、サプライヤーなど、様々なステークホルダーがサービスにアカウントを作ってログインすることになる。

それによって、あなたのサービスの利用は拡大し、事業は成長する。

逆にいうと、サービス設計者としては、顧客やビジネスサイドから要求されるまでもなく、複数部門やその他様々なステークホルダーによる利用を想定して、アカウント周りを設計する必要があるということだ。

とはいえ、先ほど述べたように、最初から全てを開発するのではなく、将来の拡張に開かれた形で今必要な実装だけ行うことが肝要だ。

アカウントや権限周りの設計するにあたり、テナントの単位は最初に考えておいた方が良いだろう。

マルチテナントなサービス基盤であれば、顧客向けのアプリケーションに与えられたDBユーザはテナント横断のSQLを打てない。

その前提を元に、テナントが会社単位で作られるのか、部署ごとに作られるのか、部署以外の単位で会社が複数テナントを持ちうるのか、ステークホルダー企業も含めた企業群の単位で作られるのか、などは事前に想像しておくと良いだろう。
これは、あなたのサービスが提供している価値の性質であったり、ビジネスモデルや将来的な事業展開の可能性に由来する。

&nbsp;

テナントの単位について決めたあとは、テナント内のアカウント設計を考える。

最初は以下を抑えておけば良いと思う。

- ユーザと所属組織はデータモデルとして分ける。ユーザに所属組織を割り当てるという考え方だと拡張しやすい。
- 権限は操作(≒WebAPIのURI+Method)を最小単位とし、ユーザに付与できるようにする。標準で定義された数個のロールを提供するという考え方もあるが多くのエンタープライズ企業では操作単位の権限は必須要件。

&nbsp;

将来的には、以下の拡張があり得ることを認識して設計しておくとよい。

&nbsp;

- 組織単位は最初はフラットで良いだろうが、将来は組織単位をノードとしたツリー構造に進化できるようにしておく。
- ユーザと所属組織の関係性は多対1とは限らない。顧客における組織構造の考え方、サービスにおける設定の仕方によっては多対多になる。
- いずれ権限を束ねたロールが必要になる。ユーザごとに権限を設定するのは面倒だし、設定が漏れても困るという納得度の高い背景がある。
- 組織単位またはロールごとに、見えるべき画面、見えてはいけない画面がある。画面単位で、組織単位またはロールに対して閲覧権限が与えられる必要がある。
- 画面単位や操作単位の権限制御に加えて、レコード単位の権限制御がいずれ必要になる。このとき、権限設定において"リソース"という考え方が必要になる。
- マスタは特定の組織単位または特定ロールのユーザが所有し、他の組織単位や他のロールによる閲覧や操作を受け付けない。
- トランザクションはトランザクションタイプの単位もしくはレコード単位で特定の組織単位が所有しており、他の組織単位による閲覧や操作は受け付けない。
- ユーザに与えられた権限を超えて操作や閲覧を許可したい場合は共有機能として機能側で設計すると良い。
- 社外のステークホルダーに何らかの機能を提供する際には、アカウント管理を各企業に行ってもらう必要があるので権限の仕組みも別になる。

## セキュリティ要件

エンタープライズ企業が重視する非機能要件のほとんどはセキュリティや事業継続性に関わるものである。そのうちセキュリティ要件についてまとめる。

まず、認証方式である。シャドーITが問題になる中、SSOが普及している。

認証(EntraID)
IPアドレス制限

## プロダクト設計

データの入口と出口
